<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/series-label.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>

<figure class="highcharts-figure">
    <div id="container"></div>
    <p class="highcharts-description">
        Basic line chart showing trends in a dataset. This chart includes the
        <code>series-label</code> module, which adds a label to each line for
        enhanced readability.
    </p>
</figure>

<script>

function csvToArray(str, delimiter = ",") {
  // slice from start of text to the first \n index
  // use split to create an array from string by delimiter
  const headers = str.slice(0, str.indexOf("\n")).split(delimiter);

  // slice from \n index + 1 to the end of the text
  // use split to create an array of each csv value row
  const rows = str.slice(str.indexOf("\n") + 1).split("\n");

  // Map the rows
  // split values from each row into an array
  // use headers.reduce to create an object
  // object properties derived from headers:values
  // the object passed as an element of the array
  const arr = rows.map(function (row) {
    const values = row.split(delimiter);
    const el = headers.reduce(function (object, header, index) {
      object[header] = values[index];
      return object;
    }, {});
    return el;
  });

  // return the array
  return arr;
}

var request = new XMLHttpRequest();
request.open('GET', 'https://xenov-x.github.io/Speedtest_Log.csv', true);
request.responseType = 'blob';
request.onload = function() {
    var reader = new FileReader();
    reader.readAsDataURL(request.response);
    reader.onload =  function(e){
        
	var base64 = e.target.result.replace('data:text/csv;base64,', '');
	var decodeddata = atob(base64);
	const data = csvToArray(decodeddata);
	console.log(data);


data.reverse();
data.forEach(function(point) {
console.log(point);
  point[0] = new Date(point[0]).getTime();
});

Highcharts.chart('container', {

  chart: {
    type: 'line'
  },
  title: {
    text: 'My chart'
  },
  xAxis: {
    type: 'datetime',

  },
  series: [{
      name: 'Support',
      color: 'green',
      data: data
    },

  ]
});
	
    };
};
request.send();





</script>